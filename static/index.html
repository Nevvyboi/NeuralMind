<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GroundZero - AI Learning System</title>
    <link rel="stylesheet" href="/static/styles.css">
    <!-- Chart.js for Neural Network Loss Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Session History Styles - Using correct CSS vars */
        .stats-panel {
            position: relative;
        }
        
        .expand-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }
        
        .expand-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .expand-btn .arrow {
            transition: transform 0.3s;
        }
        
        .expand-btn.expanded .arrow {
            transform: rotate(180deg);
        }
        
        .session-history {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out;
            margin-top: 0;
            padding-top: 0;
        }
        
        .session-history.expanded {
            max-height: 400px;
            margin-top: 16px;
            padding-top: 12px;
            overflow-y: auto;
            border-top: 1px solid var(--border);
        }
        
        .session-summary {
            background: var(--bg);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }
        
        .session-summary h4 {
            margin: 0 0 10px 0;
            color: var(--text);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .summary-item {
            text-align: center;
            padding: 8px;
            background: var(--bg-card);
            border-radius: 6px;
        }
        
        .summary-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .summary-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .session-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .session-item {
            background: var(--bg);
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .session-item:hover {
            border-color: var(--accent);
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .session-id {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
        }
        
        .session-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--accent);
            color: white;
        }
        
        .session-status.active {
            background: var(--primary);
        }
        
        .session-stats-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .session-stat {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .session-stat strong {
            color: var(--text);
        }
        
        .session-date {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        .no-sessions {
            text-align: center;
            color: var(--text-muted);
            font-size: 12px;
            padding: 20px;
        }
        
        /* Total time display */
        .total-time-display {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            text-align: center;
            color: white;
        }
        
        .total-time-label {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
        }
        
        .total-time-value {
            font-size: 24px;
            font-weight: 700;
            margin-top: 4px;
        }
        
        /* Current session stats */
        .current-session-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .session-stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 6px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .session-stat-row:last-child {
            border-bottom: none;
        }
        
        .session-stat-row span {
            color: var(--text-secondary);
        }
        
        .session-stat-row strong {
            color: var(--accent);
        }
        
        .help-text {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 8px;
        }
        
        /* Fullscreen Button */
        .btn-fullscreen {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, var(--primary) 0%, #6366f1 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 8px;
        }
        
        .btn-fullscreen:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .btn-fullscreen .fs-icon {
            font-size: 14px;
        }
        
        .btn-fullscreen.is-fullscreen {
            background: linear-gradient(135deg, var(--accent) 0%, #059669 100%);
        }
        
        .btn-fullscreen.is-fullscreen .fs-text::after {
            content: 'Exit';
        }
        
        .btn-fullscreen.is-fullscreen .fs-text {
            font-size: 0;
        }
        
        .btn-fullscreen.is-fullscreen .fs-text::after {
            font-size: 12px;
        }
        
        /* Clear Chat Button - in chat input area */
        .btn-clear-chat {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .btn-clear-chat:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }
        
        /* Knowledge Explorer Button - prominent style */
        .btn-explorer {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 14px 16px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .btn-explorer:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }
        
        .btn-explorer .explorer-icon {
            font-size: 18px;
        }
        
        .btn-explorer .explorer-text {
            flex: 1;
            text-align: left;
        }
        
        .btn-explorer .explorer-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        
        /* Neural Network Button */
        .btn-neural {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 14px 16px;
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .btn-neural:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .btn-neural .neural-icon {
            font-size: 18px;
        }
        
        .btn-neural .neural-text {
            flex: 1;
            text-align: left;
        }
        
        .btn-neural .neural-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .btn-neural.unavailable {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .btn-neural.unavailable:hover {
            transform: none;
        }
        
        /* Topic Search Button */
        .btn-topic-search {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 14px 16px;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }
        
        .btn-topic-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.4);
        }
        
        .btn-topic-search .topic-icon {
            font-size: 18px;
        }
        
        .btn-topic-search .topic-text {
            flex: 1;
            text-align: left;
        }
        
        .btn-topic-search .topic-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        
        /* System Monitor Button */
        .btn-monitor {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 14px 16px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn-monitor:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .btn-monitor .monitor-icon {
            font-size: 18px;
        }
        
        .btn-monitor .monitor-text {
            flex: 1;
            text-align: left;
        }
        
        .btn-monitor .monitor-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            animation: pulse-badge 2s infinite;
        }
        
        @keyframes pulse-badge {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* Topic Search Modal */
        .topic-search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .topic-search-modal.active {
            display: flex;
        }
        
        .topic-modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .topic-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        
        .topic-modal-header h3 {
            margin: 0;
            font-size: 18px;
        }
        
        .topic-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 4px 12px;
            border-radius: 8px;
        }
        
        .topic-modal-body {
            padding: 20px 24px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .topic-search-input-wrapper {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .topic-search-input-wrapper input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: var(--bg);
            color: var(--text);
        }
        
        .topic-search-input-wrapper input:focus {
            border-color: #06b6d4;
            outline: none;
        }
        
        .topic-results {
            min-height: 200px;
        }
        
        .topic-placeholder {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .topic-result-item {
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 12px;
            background: var(--bg);
            transition: all 0.2s;
        }
        
        .topic-result-item:hover {
            border-color: #06b6d4;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
        }
        
        .topic-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .topic-result-title {
            font-weight: 600;
            color: var(--text);
            font-size: 15px;
        }
        
        .topic-result-score {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .topic-result-stats {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .topic-result-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .topic-result-preview {
            margin-top: 10px;
            padding: 10px;
            background: var(--bg-card);
            border-radius: 8px;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .topic-no-results {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        /* System Monitor Modal */
        .system-monitor-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .system-monitor-modal.active {
            display: flex;
        }
        
        .monitor-modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .monitor-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .monitor-modal-header h3 {
            margin: 0;
            font-size: 18px;
        }
        
        .monitor-header-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .monitor-live-indicator {
            font-size: 12px;
            font-weight: 700;
            animation: pulse-live 1s infinite;
        }
        
        @keyframes pulse-live {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .monitor-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 4px 12px;
            border-radius: 8px;
        }
        
        .monitor-modal-body {
            padding: 20px 24px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .monitor-section {
            margin-bottom: 24px;
        }
        
        .monitor-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }
        
        .monitor-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        
        .monitor-card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 4px;
        }
        
        .monitor-card-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .monitor-card.warning .monitor-card-value {
            color: #f59e0b;
        }
        
        .monitor-card.danger .monitor-card-value {
            color: #ef4444;
        }
        
        .monitor-card.success .monitor-card-value {
            color: #10b981;
        }
        
        .monitor-progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .monitor-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .monitor-progress-fill.low { background: #10b981; }
        .monitor-progress-fill.medium { background: #f59e0b; }
        .monitor-progress-fill.high { background: #ef4444; }
        
        .monitor-recommendation {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .monitor-recommendation-title {
            font-weight: 600;
            color: #10b981;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .monitor-recommendation-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Neural Network Modal */
        .neural-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .neural-modal.active {
            display: flex;
        }
        
        .neural-modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border);
        }
        
        .neural-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
        }
        
        .neural-modal-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .neural-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .neural-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .neural-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }
        
        /* Neural Stats Grid */
        .neural-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .neural-stat-card {
            background: var(--bg);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .neural-stat-card:hover {
            border-color: #f59e0b;
            transform: translateY(-2px);
        }
        
        .neural-stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .neural-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 4px;
        }
        
        .neural-stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Neural Chart Section */
        .neural-chart-section {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }
        
        .neural-chart-section h4 {
            margin: 0 0 16px 0;
            font-size: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .neural-chart-container {
            height: 250px;
            position: relative;
        }
        
        /* Neural Architecture Section */
        .neural-architecture {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }
        
        .neural-architecture h4 {
            margin: 0 0 16px 0;
            font-size: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .arch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .arch-item {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
        }
        
        .arch-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .arch-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }
        
        /* Neural Status */
        .neural-status-section {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }
        
        .neural-status-section h4 {
            margin: 0 0 16px 0;
            font-size: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .status-row:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .status-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.available {
            background: #d1fae5;
            color: #059669;
        }
        
        .status-badge.unavailable {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .status-badge.training {
            background: #fef3c7;
            color: #d97706;
        }
        
        /* Neural Not Available */
        .neural-not-available {
            text-align: center;
            padding: 60px 40px;
        }
        
        .neural-not-available .na-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .neural-not-available h4 {
            margin: 0 0 12px 0;
            font-size: 20px;
            color: var(--text);
        }
        
        .neural-not-available p {
            color: var(--text-muted);
            font-size: 14px;
            margin: 0 0 20px 0;
            line-height: 1.6;
        }
        
        .neural-not-available code {
            background: var(--bg);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            color: #ef4444;
            display: inline-block;
            border: 1px solid var(--border);
        }
        
        @media (max-width: 768px) {
            .neural-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .arch-grid {
                grid-template-columns: 1fr;
            }
            
            .neural-modal-content {
                width: 95%;
                max-height: 90vh;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <span class="logo-icon">üß†</span>
            <div class="logo-text">
                <h1>GroundZero</h1>
                <span>AI that learns from scratch</span>
            </div>
        </div>
        <div class="header-stats">
            <div class="stat-pill"><span class="stat-icon">üìù</span><span id="vocab-count">0</span> words</div>
            <div class="stat-pill"><span class="stat-icon">üíæ</span><span id="knowledge-count">0</span> knowledge</div>
            <div class="stat-pill"><span class="stat-icon">üåê</span><span id="sources-count">0</span> sources</div>
            <div class="stat-pill status" id="status-indicator"><span class="pulse"></span>Ready</div>
            <button class="btn-fullscreen" id="fullscreen-btn" title="Toggle Fullscreen">
                <span class="fs-icon" id="fs-icon">‚õ∂</span>
                <span class="fs-text">Fullscreen</span>
            </button>
        </div>
    </header>

    <main class="main">
        <!-- Left Sidebar - Learning -->
        <aside class="sidebar left-sidebar">
            <div class="panel">
                <h2>‚ö° Learning Engine</h2>
                <div class="learning-controls">
                    <button class="btn btn-primary" id="start-btn">‚ñ∂ Start</button>
                    <button class="btn btn-secondary" id="stop-btn" disabled>‚ñ† Stop</button>
                </div>
                
                <!-- Learning Timer -->
                <div class="learning-timer" id="learning-timer">
                    <div class="timer-icon">‚è±Ô∏è</div>
                    <div class="timer-display">
                        <span class="timer-label">Session Time</span>
                        <span class="timer-value" id="timer-value">00:00:00</span>
                    </div>
                    <div class="timer-status" id="timer-status">Stopped</div>
                </div>
                
                <div class="currently-reading">
                    <div class="reading-header">
                        <h4>üìñ Currently Reading</h4>
                        <button class="btn-zoom" id="zoom-btn" title="View full content">
                            <span class="zoom-icon">üîç</span>
                            <span class="zoom-text">Zoom</span>
                        </button>
                    </div>
                    <a href="#" id="current-url" target="_blank">Waiting to start...</a>
                    <div class="content-preview" id="content-preview">Start learning to see content here...</div>
                </div>
                
                <!-- Zoom Modal -->
                <div class="zoom-modal" id="zoom-modal">
                    <div class="zoom-modal-content">
                        <div class="zoom-modal-header">
                            <h3 id="zoom-title">Full Content</h3>
                            <button class="zoom-close" id="zoom-close">&times;</button>
                        </div>
                        <div class="zoom-modal-body" id="zoom-body">
                            <div class="zoom-content" id="zoom-content">No content loaded yet.</div>
                        </div>
                        <div class="zoom-modal-footer">
                            <span class="zoom-stats" id="zoom-stats">0 words</span>
                            <a href="#" id="zoom-source" target="_blank">View Source</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Model Stats with Expandable Session History -->
            <div class="panel stats-panel">
                <h2>üìä Model Stats</h2>
                <button class="expand-btn" id="expand-sessions-btn">
                    <span>Sessions</span>
                    <span class="arrow">‚ñº</span>
                </button>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="vocab-stat">0</div>
                        <div class="stat-label">Vocabulary</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="tokens-count">0</div>
                        <div class="stat-label">Words</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="knowledge-stat">0</div>
                        <div class="stat-label">Knowledge</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sources-stat">0</div>
                        <div class="stat-label">Sources</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sessions-count">0</div>
                        <div class="stat-label">Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vectors-count">0</div>
                        <div class="stat-label">Vectors</div>
                    </div>
                </div>
                
                <!-- Total Learning Time -->
                <div class="total-time-display">
                    <div class="total-time-label">Total Learning Time</div>
                    <div class="total-time-value" id="total-learning-time">00:00:00</div>
                </div>
                
                <!-- Expandable Session History -->
                <div class="session-history" id="session-history">
                    <div class="session-summary">
                        <h4>üìà All-Time Summary</h4>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-value" id="total-sessions">0</div>
                                <div class="summary-label">Sessions</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="total-articles">0</div>
                                <div class="summary-label">Articles</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="total-words-learned">0</div>
                                <div class="summary-label">Words</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="total-knowledge-added">0</div>
                                <div class="summary-label">Knowledge</div>
                            </div>
                        </div>
                    </div>
                    
                    <h4 style="margin: 0 0 8px 0; font-size: 13px; color: var(--text-primary);">üìú Session History</h4>
                    <div class="session-list" id="session-list">
                        <div class="no-sessions">No sessions yet. Start learning!</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <section class="chat-section">
            <div class="chat-messages" id="chat-messages">
                <div class="message ai">
                    <div class="avatar">üß†</div>
                    <div class="content">
                        <p>Hello! I'm <strong>GroundZero</strong>, an AI that learns from scratch.</p>
                        <p>I have a <strong>neural network</strong> that gets smarter as I learn! Check the üß† Neural Network button to see my brain stats.</p>
                        <p>Try asking me anything - I'll either answer from what I know, or search to find out.</p>
                        <span class="time">Just now</span>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-area">
                <button class="btn-clear-chat" id="clear-chat-btn" title="Clear chat context">
                    üóëÔ∏è
                </button>
                <textarea id="chat-input" placeholder="Ask me anything... I'll search if I don't know!" rows="1"></textarea>
                <button class="btn btn-primary btn-send" id="send-btn">
                    <span class="send-icon">‚û§</span>
                </button>
            </div>
        </section>

        <!-- Right Sidebar - Tools -->
        <aside class="sidebar right-sidebar">
            <!-- Knowledge Explorer Button -->
            <button class="btn btn-explorer" id="knowledge-explorer-btn">
                <span class="explorer-icon">üî¨</span>
                <span class="explorer-text">Knowledge Explorer</span>
                <span class="explorer-badge" id="knowledge-badge">0</span>
            </button>
            
            <!-- Neural Network Button -->
            <button class="btn btn-neural" id="neural-btn">
                <span class="neural-icon">üß†</span>
                <span class="neural-text">Neural Network</span>
                <span class="neural-badge" id="neural-badge">--</span>
            </button>
            
            <!-- Topic Search Button -->
            <button class="btn btn-topic-search" id="topic-search-btn">
                <span class="topic-icon">üîé</span>
                <span class="topic-text">Topic Search</span>
                <span class="topic-badge">Search</span>
            </button>
            
            <!-- System Monitor Button -->
            <button class="btn btn-monitor" id="system-monitor-btn">
                <span class="monitor-icon">üìä</span>
                <span class="monitor-text">System Monitor</span>
                <span class="monitor-badge" id="monitor-badge">Live</span>
            </button>
            
            <div class="panel">
                <h2>üìö Teach AI</h2>
                <textarea id="teach-content" placeholder="Enter knowledge..." rows="2"></textarea>
                <button class="btn btn-accent btn-full" id="teach-btn">üß† Teach</button>
            </div>
            
            <div class="panel">
                <h2>üîç Manual Learn</h2>
                <input type="text" id="learn-url" placeholder="Paste any URL...">
                <button class="btn btn-primary btn-full" id="learn-url-btn">üåê Learn from URL</button>
                <div id="learning-progress-container"></div>
                <p class="help-text">üí° URLs are only learned once - duplicates are skipped!</p>
            </div>
            
            <div class="panel">
                <h2>üåê Recent Sources</h2>
                <div id="learned-sources" class="sources-list">
                    <p class="empty-text">No sources yet</p>
                </div>
            </div>
            
            <div class="panel">
                <h2>üìù Current Session</h2>
                <div class="current-session-stats">
                    <div class="session-stat-row">
                        <span>Articles:</span>
                        <strong id="current-articles">0</strong>
                    </div>
                    <div class="session-stat-row">
                        <span>Words:</span>
                        <strong id="current-words">0</strong>
                    </div>
                    <div class="session-stat-row">
                        <span>Knowledge:</span>
                        <strong id="current-knowledge">0</strong>
                    </div>
                    <div class="session-stat-row">
                        <span>Neural Tokens:</span>
                        <strong id="current-neural-tokens">0</strong>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Knowledge Explorer Modal -->
    <div class="knowledge-explorer-modal" id="knowledge-explorer-modal">
        <div class="ke-modal-content">
            <div class="ke-modal-header">
                <h3>üî¨ Knowledge Explorer</h3>
                <button class="ke-close" id="ke-close">&times;</button>
            </div>
            <div class="ke-body-wrapper">
                <div class="ke-modal-body">
                    <div class="ke-search">
                        <input type="text" id="ke-search-input" placeholder="üîç Search topics...">
                    </div>
                    <div class="ke-list" id="ke-list">
                        <div class="ke-loading">Loading knowledge base...</div>
                    </div>
                </div>
                <div class="ke-detail-panel" id="ke-detail-panel">
                    <div class="ke-detail-header">
                        <h4 id="ke-detail-title">Select a topic</h4>
                        <span class="ke-confidence" id="ke-detail-confidence"></span>
                    </div>
                    <div class="ke-related">
                        <h5>üîó Related Topics</h5>
                        <div class="ke-related-list" id="ke-related-list">
                            <p class="empty-text">Click on a topic to see related concepts</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Knowledge Explorer Modal */
        .knowledge-explorer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        
        .knowledge-explorer-modal.active {
            display: flex;
        }
        
        .ke-modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            width: 90%;
            max-width: 1000px;
            height: 80vh;
            max-height: 650px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .ke-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
            flex-shrink: 0;
        }
        
        .ke-modal-header h3 {
            margin: 0;
            font-size: 18px;
            color: var(--text);
            font-weight: 600;
        }
        
        .ke-close {
            background: var(--bg-card);
            border: 1px solid var(--border);
            font-size: 18px;
            cursor: pointer;
            color: var(--text-muted);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .ke-close:hover {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        
        .ke-body-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .ke-modal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-right: 1px solid var(--border);
        }
        
        .ke-search {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
            flex-shrink: 0;
        }
        
        .ke-search input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--bg-card);
            color: var(--text);
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .ke-search input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .ke-search input::placeholder {
            color: var(--text-muted);
        }
        
        .ke-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg-card);
        }
        
        .ke-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            margin-bottom: 8px;
            background: var(--bg);
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .ke-item:hover {
            border-color: var(--primary);
            background: #eff6ff;
        }
        
        .ke-item.selected {
            border-color: var(--primary);
            background: #dbeafe;
        }
        
        .ke-item-title {
            font-size: 14px;
            color: var(--text);
            font-weight: 500;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 12px;
        }
        
        .ke-item-confidence {
            font-size: 12px;
            padding: 5px 12px;
            border-radius: 20px;
            background: var(--primary);
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .ke-detail-panel {
            width: 300px;
            background: var(--bg);
            padding: 20px;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .ke-detail-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .ke-detail-header h4 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: var(--text);
            font-weight: 600;
            line-height: 1.4;
        }
        
        .ke-confidence {
            display: none;
            font-size: 12px;
            padding: 5px 12px;
            border-radius: 20px;
            background: var(--accent);
            color: white;
            font-weight: 600;
        }
        
        .ke-related h5 {
            margin: 0 0 14px 0;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .ke-related-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .ke-related-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 14px;
            background: var(--bg-card);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }
        
        .ke-related-item:hover {
            background: #eff6ff;
            border-color: var(--primary);
        }
        
        .ke-related-title {
            font-size: 13px;
            color: var(--text);
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 10px;
        }
        
        .ke-related-similarity {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 12px;
            background: var(--accent);
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .ke-loading,
        .ke-loading-small {
            text-align: center;
            color: var(--text-muted);
            padding: 40px 20px;
            font-size: 14px;
        }
        
        .ke-loading-small {
            padding: 20px;
        }
        
        .ke-empty {
            text-align: center;
            color: var(--text-muted);
            padding: 60px 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .ke-hint {
            color: var(--text-muted);
            font-size: 13px;
            text-align: center;
            padding: 20px;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .ke-modal-content {
                width: 95%;
                height: 90vh;
            }
            
            .ke-body-wrapper {
                flex-direction: column;
            }
            
            .ke-modal-body {
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
            
            .ke-detail-panel {
                width: 100%;
                max-height: 220px;
            }
        }
    </style>

    <!-- Neural Network Modal -->
    <div class="neural-modal" id="neural-modal">
        <div class="neural-modal-content">
            <div class="neural-modal-header">
                <h3>üß† Neural Network Status</h3>
                <button class="neural-close" id="neural-close">&times;</button>
            </div>
            <div class="neural-modal-body" id="neural-modal-body">
                <div class="neural-loading" style="text-align: center; padding: 60px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">‚è≥</div>
                    <p>Loading neural network stats...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Topic Search Modal -->
    <div class="topic-search-modal" id="topic-search-modal">
        <div class="topic-modal-content">
            <div class="topic-modal-header">
                <h3>üîé Topic Search</h3>
                <button class="topic-close" id="topic-close">&times;</button>
            </div>
            <div class="topic-modal-body">
                <div class="topic-search-input-wrapper">
                    <input type="text" id="topic-search-input" placeholder="Search for any topic..." autofocus>
                    <button class="btn btn-primary" id="topic-search-go">Search</button>
                </div>
                <div id="topic-search-results" class="topic-results">
                    <div class="topic-placeholder">
                        <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                        <p>Enter a topic to search your knowledge base</p>
                        <p class="help-text">e.g., "France", "Python", "Machine Learning"</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Monitor Modal -->
    <div class="system-monitor-modal" id="system-monitor-modal">
        <div class="monitor-modal-content">
            <div class="monitor-modal-header">
                <h3>üìä System Monitor</h3>
                <div class="monitor-header-controls">
                    <span class="monitor-live-indicator" id="monitor-live-indicator">‚óè LIVE</span>
                    <button class="monitor-close" id="monitor-close">&times;</button>
                </div>
            </div>
            <div class="monitor-modal-body" id="monitor-modal-body">
                <div class="monitor-loading" style="text-align: center; padding: 60px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">‚è≥</div>
                    <p>Loading system stats...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>
    <script src="/static/app.js"></script>
    
    <!-- Neural Network Stats Script -->
    <script>
        // Neural Network Modal Management
        const neuralBtn = document.getElementById('neural-btn');
        const neuralModal = document.getElementById('neural-modal');
        const neuralClose = document.getElementById('neural-close');
        const neuralModalBody = document.getElementById('neural-modal-body');
        const neuralBadge = document.getElementById('neural-badge');
        
        let neuralChart = null;
        let neuralAvailable = false;
        
        // Open Neural Modal
        neuralBtn.addEventListener('click', () => {
            neuralModal.classList.add('active');
            loadNeuralStats();
        });
        
        // Close Neural Modal
        neuralClose.addEventListener('click', () => {
            neuralModal.classList.remove('active');
        });
        
        neuralModal.addEventListener('click', (e) => {
            if (e.target === neuralModal) {
                neuralModal.classList.remove('active');
            }
        });
        
        // Load Neural Stats
        async function loadNeuralStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (data.neural && data.neural.available) {
                    neuralAvailable = true;
                    renderNeuralStats(data.neural);
                    neuralBtn.classList.remove('unavailable');
                    neuralBadge.textContent = formatNumber(data.neural.model_params || 0);
                } else {
                    neuralAvailable = false;
                    renderNeuralUnavailable();
                    neuralBtn.classList.add('unavailable');
                    neuralBadge.textContent = 'N/A';
                }
            } catch (error) {
                console.error('Error loading neural stats:', error);
                renderNeuralUnavailable();
            }
        }
        
        // Render Neural Stats
        function renderNeuralStats(stats) {
            const recentLosses = stats.recent_losses || [];
            const hasLossData = recentLosses.length > 0;
            
            neuralModalBody.innerHTML = `
                <!-- Stats Grid -->
                <div class="neural-stats-grid">
                    <div class="neural-stat-card">
                        <div class="neural-stat-icon">üî¢</div>
                        <div class="neural-stat-value">${formatNumber(stats.model_params || 0)}</div>
                        <div class="neural-stat-label">Parameters</div>
                    </div>
                    <div class="neural-stat-card">
                        <div class="neural-stat-icon">üìö</div>
                        <div class="neural-stat-value">${formatNumber(stats.total_tokens_trained || 0)}</div>
                        <div class="neural-stat-label">Tokens Trained</div>
                    </div>
                    <div class="neural-stat-card">
                        <div class="neural-stat-icon">üìñ</div>
                        <div class="neural-stat-value">${formatNumber(stats.vocab_size || 0)}</div>
                        <div class="neural-stat-label">Vocabulary</div>
                    </div>
                    <div class="neural-stat-card">
                        <div class="neural-stat-icon">üîÑ</div>
                        <div class="neural-stat-value">${formatNumber(stats.global_step || 0)}</div>
                        <div class="neural-stat-label">Training Steps</div>
                    </div>
                </div>
                
                <!-- Loss Chart -->
                <div class="neural-chart-section">
                    <h4>üìâ Training Loss History</h4>
                    <div class="neural-chart-container">
                        ${hasLossData ? '<canvas id="loss-chart"></canvas>' : '<p style="text-align: center; color: var(--text-muted); padding: 60px;">No training data yet. Start learning to see the loss curve!</p>'}
                    </div>
                </div>
                
                <!-- Architecture Info -->
                <div class="neural-architecture">
                    <h4>üèóÔ∏è Model Architecture</h4>
                    <div class="arch-grid">
                        <div class="arch-item">
                            <span class="arch-label">Model Type</span>
                            <span class="arch-value">GroundZero Neural</span>
                        </div>
                        <div class="arch-item">
                            <span class="arch-label">Layers</span>
                            <span class="arch-value">${stats.n_layers || '4'}</span>
                        </div>
                        <div class="arch-item">
                            <span class="arch-label">Attention Heads</span>
                            <span class="arch-value">${stats.n_heads || '4'}</span>
                        </div>
                        <div class="arch-item">
                            <span class="arch-label">Embedding Dim</span>
                            <span class="arch-value">${stats.d_model || '256'}</span>
                        </div>
                        <div class="arch-item">
                            <span class="arch-label">Context Length</span>
                            <span class="arch-value">${stats.max_seq_len || '512'}</span>
                        </div>
                        <div class="arch-item">
                            <span class="arch-label">Replay Buffer</span>
                            <span class="arch-value">${formatNumber(stats.replay_buffer_size || 0)}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Status Section -->
                <div class="neural-status-section">
                    <h4>‚öôÔ∏è System Status</h4>
                    <div class="status-row">
                        <span class="status-label">Neural Network</span>
                        <span class="status-badge available">‚úì Available</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Device</span>
                        <span class="status-value">${stats.device || 'cpu'}</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Training Status</span>
                        <span class="status-badge ${stats.is_training ? 'training' : 'available'}">${stats.is_training ? '‚ü≥ Training' : '‚óè Ready'}</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Texts in Buffer</span>
                        <span class="status-value">${stats.buffer_size || 0}</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Latest Loss</span>
                        <span class="status-value">${recentLosses.length > 0 ? recentLosses[recentLosses.length - 1].toFixed(4) : 'N/A'}</span>
                    </div>
                </div>
            `;
            
            // Render chart if we have data
            if (hasLossData) {
                renderLossChart(recentLosses);
            }
        }
        
        // Render Loss Chart
        function renderLossChart(losses) {
            const ctx = document.getElementById('loss-chart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (neuralChart) {
                neuralChart.destroy();
            }
            
            const labels = losses.map((_, i) => `Step ${i + 1}`);
            
            neuralChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Training Loss',
                        data: losses,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ef4444',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#6b7280'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#6b7280'
                            },
                            title: {
                                display: true,
                                text: 'Loss',
                                color: '#6b7280'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        // Render Neural Unavailable
        function renderNeuralUnavailable() {
            neuralModalBody.innerHTML = `
                <div class="neural-not-available">
                    <div class="na-icon">üß†</div>
                    <h4>Neural Network Not Available</h4>
                    <p>The neural network module is not installed or failed to initialize.<br>
                    Install PyTorch to enable neural network capabilities:</p>
                    <code>pip install torch</code>
                </div>
            `;
        }
        
        // Format number helper
        function formatNumber(num) {
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(1) + 'B';
            } else if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Update neural badge periodically
        async function updateNeuralBadge() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (data.neural && data.neural.available) {
                    neuralBadge.textContent = formatNumber(data.neural.model_params || 0);
                    neuralBtn.classList.remove('unavailable');
                    
                    // Update current session neural tokens
                    const neuralTokensEl = document.getElementById('current-neural-tokens');
                    if (neuralTokensEl && data.neural.total_tokens_trained) {
                        neuralTokensEl.textContent = formatNumber(data.neural.total_tokens_trained);
                    }
                } else {
                    neuralBadge.textContent = 'N/A';
                    neuralBtn.classList.add('unavailable');
                }
            } catch (error) {
                // Silently fail
            }
        }
        
        // Initial load and periodic update
        updateNeuralBadge();
        setInterval(updateNeuralBadge, 10000); // Update every 10 seconds
    </script>
    
    <!-- Topic Search Script -->
    <script>
        // Topic Search Modal Management
        const topicSearchBtn = document.getElementById('topic-search-btn');
        const topicSearchModal = document.getElementById('topic-search-modal');
        const topicClose = document.getElementById('topic-close');
        const topicSearchInput = document.getElementById('topic-search-input');
        const topicSearchGo = document.getElementById('topic-search-go');
        const topicSearchResults = document.getElementById('topic-search-results');
        
        // Open Topic Search Modal
        topicSearchBtn.addEventListener('click', () => {
            topicSearchModal.classList.add('active');
            topicSearchInput.focus();
        });
        
        // Close Modal
        topicClose.addEventListener('click', () => {
            topicSearchModal.classList.remove('active');
        });
        
        topicSearchModal.addEventListener('click', (e) => {
            if (e.target === topicSearchModal) {
                topicSearchModal.classList.remove('active');
            }
        });
        
        // Search on Enter
        topicSearchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performTopicSearch();
            }
        });
        
        topicSearchGo.addEventListener('click', performTopicSearch);
        
        async function performTopicSearch() {
            const query = topicSearchInput.value.trim();
            if (!query) return;
            
            topicSearchResults.innerHTML = `
                <div class="topic-placeholder">
                    <div style="font-size: 32px; margin-bottom: 12px;">‚è≥</div>
                    <p>Searching for "${query}"...</p>
                </div>
            `;
            
            try {
                const response = await fetch('/api/knowledge/search-topics', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, limit: 10 })
                });
                
                const data = await response.json();
                renderTopicResults(data, query);
                
            } catch (error) {
                topicSearchResults.innerHTML = `
                    <div class="topic-no-results">
                        <div style="font-size: 32px; margin-bottom: 12px;">‚ùå</div>
                        <p>Error searching: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function renderTopicResults(data, query) {
            if (!data.results || data.results.length === 0) {
                topicSearchResults.innerHTML = `
                    <div class="topic-no-results">
                        <div style="font-size: 48px; margin-bottom: 16px;">ü§∑</div>
                        <p>No results found for "${query}"</p>
                        <p class="help-text">Try searching Wikipedia or teaching me about this topic!</p>
                    </div>
                `;
                return;
            }
            
            const stats = data.stats || {};
            const kbStats = stats.knowledge_base || {};
            
            let html = `
                <div class="topic-stats-summary" style="background: var(--bg); padding: 12px 16px; border-radius: 10px; margin-bottom: 16px; display: flex; gap: 20px; flex-wrap: wrap;">
                    <div><strong>${data.results.length}</strong> <span style="color: var(--text-secondary);">results found</span></div>
                    <div><strong>${stats.avg_relevance || 0}%</strong> <span style="color: var(--text-secondary);">avg relevance</span></div>
                    <div><strong>${(kbStats.total_entries || 0).toLocaleString()}</strong> <span style="color: var(--text-secondary);">total knowledge</span></div>
                </div>
            `;
            
            for (const result of data.results) {
                const score = result.relevance || 0;
                const preview = result.preview || '';
                
                html += `
                    <div class="topic-result-item">
                        <div class="topic-result-header">
                            <span class="topic-result-title">${result.title || 'Untitled'}</span>
                            <span class="topic-result-score">${score}% match</span>
                        </div>
                        <div class="topic-result-stats">
                            <span class="topic-result-stat">üìù ${(result.word_count || 0).toLocaleString()} words</span>
                            <span class="topic-result-stat">üìä ${result.confidence || 70}% confidence</span>
                            ${result.url ? `<span class="topic-result-stat">üîó <a href="${result.url}" target="_blank" style="color: #06b6d4;">Source</a></span>` : ''}
                        </div>
                        <div class="topic-result-preview">${preview}</div>
                    </div>
                `;
            }
            
            topicSearchResults.innerHTML = html;
        }
    </script>
    
    <!-- System Monitor Script -->
    <script>
        // System Monitor Modal Management
        const monitorBtn = document.getElementById('system-monitor-btn');
        const monitorModal = document.getElementById('system-monitor-modal');
        const monitorClose = document.getElementById('monitor-close');
        const monitorModalBody = document.getElementById('monitor-modal-body');
        const monitorLiveIndicator = document.getElementById('monitor-live-indicator');
        
        let monitorInterval = null;
        
        // Open System Monitor Modal
        monitorBtn.addEventListener('click', () => {
            monitorModal.classList.add('active');
            loadSystemStats();
            // Start live updates
            monitorInterval = setInterval(loadSystemStats, 2000);
        });
        
        // Close Modal
        monitorClose.addEventListener('click', () => {
            monitorModal.classList.remove('active');
            if (monitorInterval) {
                clearInterval(monitorInterval);
                monitorInterval = null;
            }
        });
        
        monitorModal.addEventListener('click', (e) => {
            if (e.target === monitorModal) {
                monitorModal.classList.remove('active');
                if (monitorInterval) {
                    clearInterval(monitorInterval);
                    monitorInterval = null;
                }
            }
        });
        
        async function loadSystemStats() {
            try {
                const response = await fetch('/api/system/monitor');
                const data = await response.json();
                renderSystemStats(data);
            } catch (error) {
                monitorModalBody.innerHTML = `
                    <div style="text-align: center; padding: 60px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">‚ùå</div>
                        <p>Error loading system stats: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function renderSystemStats(data) {
            const process = data.process || {};
            const system = data.system || {};
            const kb = data.knowledge_base || {};
            const embeddings = data.embeddings || {};
            const neural = data.neural_network || {};
            const graph = data.knowledge_graph || {};
            const strategic = data.strategic_learning || {};
            const gpu = data.gpu || {};
            const recommendations = data.recommendations || [];
            
            // Calculate usage levels
            const memoryPercent = system.memory_percent || 0;
            const cpuPercent = system.cpu_percent || 0;
            const processMemPercent = process.memory_percent || 0;
            
            const getLevel = (percent) => {
                if (percent < 50) return 'low';
                if (percent < 80) return 'medium';
                return 'high';
            };
            
            const getCardClass = (percent) => {
                if (percent < 50) return 'success';
                if (percent < 80) return 'warning';
                return 'danger';
            };
            
            let html = `
                <!-- Process Resources -->
                <div class="monitor-section">
                    <div class="monitor-section-title">‚öôÔ∏è Application Process</div>
                    <div class="monitor-grid">
                        <div class="monitor-card ${getCardClass(processMemPercent)}">
                            <div class="monitor-card-value">${processMemPercent.toFixed(1)}%</div>
                            <div class="monitor-card-label">App Memory</div>
                            <div class="monitor-progress-bar">
                                <div class="monitor-progress-fill ${getLevel(processMemPercent)}" style="width: ${processMemPercent}%"></div>
                            </div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${process.memory_mb || 0} MB</div>
                            <div class="monitor-card-label">RAM Used</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${process.cpu_percent || 0}%</div>
                            <div class="monitor-card-label">CPU Usage</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${process.threads || 0}</div>
                            <div class="monitor-card-label">Threads</div>
                        </div>
                    </div>
                </div>
                
                <!-- System Resources -->
                <div class="monitor-section">
                    <div class="monitor-section-title">üíª System Resources</div>
                    <div class="monitor-grid">
                        <div class="monitor-card ${getCardClass(memoryPercent)}">
                            <div class="monitor-card-value">${memoryPercent.toFixed(1)}%</div>
                            <div class="monitor-card-label">System Memory</div>
                            <div class="monitor-progress-bar">
                                <div class="monitor-progress-fill ${getLevel(memoryPercent)}" style="width: ${memoryPercent}%"></div>
                            </div>
                        </div>
                        <div class="monitor-card ${getCardClass(cpuPercent)}">
                            <div class="monitor-card-value">${cpuPercent.toFixed(1)}%</div>
                            <div class="monitor-card-label">System CPU</div>
                            <div class="monitor-progress-bar">
                                <div class="monitor-progress-fill ${getLevel(cpuPercent)}" style="width: ${cpuPercent}%"></div>
                            </div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${system.memory_total_gb || 0} GB</div>
                            <div class="monitor-card-label">Total RAM</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${system.memory_available_gb || 0} GB</div>
                            <div class="monitor-card-label">Available RAM</div>
                        </div>
                    </div>
                </div>
                
                <!-- Knowledge Base -->
                <div class="monitor-section">
                    <div class="monitor-section-title">üìö Knowledge Base</div>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(kb.total_entries || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Knowledge Entries</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(kb.total_words || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Total Words</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(kb.vocabulary_size || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Vocabulary Size</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${kb.vector_dimension || 256}</div>
                            <div class="monitor-card-label">Vector Dimension</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${kb.index_type || 'FAISS'}</div>
                            <div class="monitor-card-label">Index Type</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${kb.faiss_available ? '‚úÖ' : '‚ùå'}</div>
                            <div class="monitor-card-label">FAISS</div>
                        </div>
                    </div>
                </div>
                
                <!-- Neural Network -->
                <div class="monitor-section">
                    <div class="monitor-section-title">üß† Neural Network</div>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-card-value">${neural.available ? '‚úÖ Online' : '‚ùå Offline'}</div>
                            <div class="monitor-card-label">Status</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${neural.parameters_formatted || formatNumber(neural.parameters || 0)}</div>
                            <div class="monitor-card-label">Parameters</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${neural.estimated_memory_mb || 0} MB</div>
                            <div class="monitor-card-label">Model Memory</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(neural.tokens_trained || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Tokens Trained</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(neural.vocabulary_size || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Vocab Size</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${neural.num_layers || 0}L / ${neural.num_heads || 0}H</div>
                            <div class="monitor-card-label">Layers / Heads</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${neural.embedding_dim || 0}</div>
                            <div class="monitor-card-label">Embedding Dim</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${neural.last_loss ? neural.last_loss.toFixed(4) : 'N/A'}</div>
                            <div class="monitor-card-label">Last Loss</div>
                        </div>
                    </div>
                </div>
                
                <!-- Knowledge Graph -->
                ${graph.available ? `
                <div class="monitor-section">
                    <div class="monitor-section-title">üï∏Ô∏è Knowledge Graph</div>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(graph.total_facts || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Total Facts</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(graph.total_entities || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Entities</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(graph.total_relations || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Relations</div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <!-- Strategic Learning -->
                ${strategic.available ? `
                <div class="monitor-section">
                    <div class="monitor-section-title">üéØ Strategic Learning</div>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(strategic.learned_titles || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Articles Tracked</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(strategic.vital_progress?.learned_vital || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Vital Learned</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(strategic.vital_progress?.remaining_vital || 0).toLocaleString()}</div>
                            <div class="monitor-card-label">Vital Remaining</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${(strategic.vital_progress?.percentage || 0).toFixed(1)}%</div>
                            <div class="monitor-card-label">Vital Progress</div>
                            <div class="monitor-progress-bar">
                                <div class="monitor-progress-fill low" style="width: ${strategic.vital_progress?.percentage || 0}%"></div>
                            </div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${strategic.categories_queued || 0}</div>
                            <div class="monitor-card-label">Categories Queued</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value" style="font-size: 14px;">${strategic.next_source || 'N/A'}</div>
                            <div class="monitor-card-label">Next Source</div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <!-- GPU Info -->
                ${gpu.cuda_available ? `
                <div class="monitor-section">
                    <div class="monitor-section-title">üéÆ GPU (CUDA)</div>
                    <div class="monitor-grid">
                        <div class="monitor-card success">
                            <div class="monitor-card-value">‚úÖ</div>
                            <div class="monitor-card-label">CUDA Available</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${gpu.device_name || 'Unknown'}</div>
                            <div class="monitor-card-label">Device</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${gpu.memory_allocated_mb || 0} MB</div>
                            <div class="monitor-card-label">Memory Allocated</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-card-value">${gpu.memory_reserved_mb || 0} MB</div>
                            <div class="monitor-card-label">Memory Reserved</div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <!-- Recommendations -->
                ${generateRecommendationsHTML(recommendations, process, neural)}
            `;
            
            monitorModalBody.innerHTML = html;
        }
        
        function generateRecommendationsHTML(recommendations, process, neural) {
            let html = '<div class="monitor-recommendation">';
            html += '<div class="monitor-recommendation-title">üí° Recommendations</div>';
            html += '<div class="monitor-recommendation-text">';
            
            if (recommendations.length > 0) {
                html += '<ul style="margin: 0; padding-left: 20px;">';
                for (const rec of recommendations) {
                    const icon = rec.type === 'warning' ? '‚ö†Ô∏è' : rec.type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
                    html += `<li style="margin-bottom: 8px;">${icon} ${rec.message}</li>`;
                }
                html += '</ul>';
            } else {
                const memPercent = process.memory_percent || 0;
                if (memPercent < 30) {
                    html += 'üöÄ <strong>Excellent!</strong> System resources are plentiful. You could use a larger neural network model for better quality.';
                } else if (memPercent < 60) {
                    html += '‚úÖ <strong>Good.</strong> System is running efficiently with balanced resource usage.';
                } else {
                    html += '‚ö†Ô∏è <strong>Consider optimization.</strong> Try a smaller model if experiencing slowdowns.';
                }
            }
            
            html += '</div></div>';
            return html;
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        function formatNumber(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
    </script>
</body>
</html>